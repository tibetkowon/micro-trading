{% extends "base.html" %}
{% block title %}종목 - Micro Trading{% endblock %}

{% block content %}
<h2 class="page-title">종목</h2>

<details class="form-panel" open>
    <summary class="form-panel-header">내 메모 종목</summary>
    <div class="form-panel-body">
        <form hx-post="/stocks/memo" hx-target="#memo-list" hx-swap="innerHTML" class="memo-add-form">
            <div class="form-grid">
                <div>
                    <label for="memo-symbol">종목코드</label>
                    <input type="text" name="symbol" id="memo-symbol" required placeholder="005930">
                </div>
                <div>
                    <label for="memo-market">시장</label>
                    <select name="market" id="memo-market">
                        <option value="KR">한국 (KR)</option>
                        <option value="US">미국 (US)</option>
                    </select>
                </div>
                <div>
                    <label for="memo-name">종목명</label>
                    <input type="text" name="name" id="memo-name" required placeholder="삼성전자">
                </div>
                <div>
                    <label for="memo-text">메모</label>
                    <input type="text" name="memo" id="memo-text" placeholder="주력 종목">
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                <button type="button" id="memo-price-btn" class="btn btn-outline btn-sm">종목 조회</button>
                <div id="memo-price-display" class="price-display"></div>
            </div>
            <button type="submit" class="btn btn-primary">메모 저장</button>
        </form>

        <div id="memo-list" style="margin-top: 1rem;">
            {% include "partials/memo_table.html" %}
        </div>
    </div>
</details>

<div class="section-grid">
    <section>
        <h3 class="section-title">한국 주요종목 (KR)</h3>
        <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>종목코드</th>
                    <th>종목명</th>
                    <th>현재가</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for s in kr_stocks %}
                <tr>
                    <td><strong>{{ s.symbol }}</strong></td>
                    <td>{{ s.name }}</td>
                    <td>
                        <span id="price-KR-{{ s.symbol }}" class="price-display price-inline"></span>
                        <button
                            class="btn btn-outline btn-sm btn-fetch-price"
                            data-symbol="{{ s.symbol }}"
                            data-market="KR"
                        >현재가</button>
                    </td>
                    <td>
                        <button
                            hx-post="/stocks/memo"
                            hx-vals='{"symbol": "{{ s.symbol }}", "market": "KR", "name": "{{ s.name }}", "memo": ""}'
                            hx-target="#memo-list"
                            hx-swap="innerHTML"
                            class="btn btn-outline btn-sm"
                        >+ 메모</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </section>
    <section>
        <h3 class="section-title">미국 주요종목 (US)</h3>
        <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>종목코드</th>
                    <th>종목명</th>
                    <th>현재가</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for s in us_stocks %}
                <tr>
                    <td><strong>{{ s.symbol }}</strong></td>
                    <td>{{ s.name }}</td>
                    <td>
                        <span id="price-US-{{ s.symbol }}" class="price-display price-inline"></span>
                        <button
                            class="btn btn-outline btn-sm btn-fetch-price"
                            data-symbol="{{ s.symbol }}"
                            data-market="US"
                        >현재가</button>
                    </td>
                    <td>
                        <button
                            hx-post="/stocks/memo"
                            hx-vals='{"symbol": "{{ s.symbol }}", "market": "US", "name": "{{ s.name }}", "memo": ""}'
                            hx-target="#memo-list"
                            hx-swap="innerHTML"
                            class="btn btn-outline btn-sm"
                        >+ 메모</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </section>
</div>
{% endblock %}
